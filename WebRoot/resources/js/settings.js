var Settings={};Settings.LoginSkin={uploadWin:null,colorPickerWin:null,colorPickerTpl:['<table id="color-picker" class="color_picker" cellspacing="0" cellpadding="0" borde="0">',"<tr>",'<td><div style="background:#7e0000; border-color:#7e0000" _color="#7e0000"></div></td>','<td><div style="background:#802d00; border-color:#802d00" _color="#802d00"></div></td>','<td><div style="background:#844d00; border-color:#844d00" _color="#844d00"></div></td>','<td><div style="background:#8a7e00; border-color:#8a7e00" _color="#8a7e00"></div></td>','<td><div style="background:#486a00; border-color:#486a00" _color="#486a00"></div></td>','<td><div style="background:#005e13; border-color:#005e13" _color="#005e13"></div></td>','<td><div style="background:#00561e; border-color:#00561e" _color="#00561e"></div></td>','<td><div style="background:#005852; border-color:#005852" _color="#005852"></div></td>','<td><div style="background:#005882; border-color:#005882" _color="#005882"></div></td>','<td><div style="background:#003266; border-color:#003266" _color="#003266"></div></td>','<td><div style="background:#001a58; border-color:#001a58" _color="#001a58"></div></td>','<td><div style="background:#01004b; border-color:#01004b" _color="#01004b"></div></td>','<td><div style="background:#30004a; border-color:#30004a" _color="#30004a"></div></td>','<td><div style="background:#500043; border-color:#500043" _color="#500043"></div></td>','<td><div style="background:#660144; border-color:#660144" _color="#660144"></div></td>','<td><div style="background:#700138; border-color:#700138" _color="#700138"></div></td>','<td><div style="background:#535353; border-color:#535353" _color="#535353"></div></td>',"</tr>","<tr>",'<td><div style="background:#9a0000; border-color:#9a0000" _color="#9a0000"></div></td>','<td><div style="background:#a83f00; border-color:#a83f00" _color="#a83f00"></div></td>','<td><div style="background:#ac6900; border-color:#ac6900" _color="#ac6900"></div></td>','<td><div style="background:#b6a700; border-color:#b6a700" _color="#b6a700"></div></td>','<td><div style="background:#638c0b; border-color:#638c0b" _color="#638c0b"></div></td>','<td><div style="background:#0c7d24; border-color:#0c7d24" _color="#0c7d24"></div></td>','<td><div style="background:#007230; border-color:#007230" _color="#007230"></div></td>','<td><div style="background:#00746d; border-color:#00746d" _color="#00746d"></div></td>','<td><div style="background:#0074aa; border-color:#0074aa" _color="#0074aa"></div></td>','<td><div style="background:#004886; border-color:#004886" _color="#004886"></div></td>','<td><div style="background:#002e74; border-color:#002e74" _color="#002e74"></div></td>','<td><div style="background:#110b64; border-color:#110b64" _color="#110b64"></div></td>','<td><div style="background:#430063; border-color:#430063" _color="#430063"></div></td>','<td><div style="background:#6a005c; border-color:#6a005c" _color="#6a005c"></div></td>','<td><div style="background:#a40054; border-color:#a40054" _color="#a40054"></div></td>','<td><div style="background:#a40032; border-color:#a40032" _color="#a40032"></div></td>','<td><div style="background:#7c7c7c; border-color:#7c7c7c" _color="#7c7c7c"></div></td>',"</tr>","<tr>",'<td><div style="background:#e6000a; border-color:#e6000a" _color="#e6000a"></div></td>','<td><div style="background:#eb5e00; border-color:#eb5e00" _color="#eb5e00"></div></td>','<td><div style="background:#f49500; border-color:#f49500" _color="#f49500"></div></td>','<td><div style="background:#fff001; border-color:#fff001" _color="#fff001"></div></td>','<td><div style="background:#8ec21f; border-color:#8ec21f" _color="#8ec21f"></div></td>','<td><div style="background:#23ac39; border-color:#23ac39" _color="#23ac39"></div></td>','<td><div style="background:#009a44; border-color:#009a44" _color="#009a44"></div></td>','<td><div style="background:#009e94; border-color:#009e94" _color="#009e94"></div></td>','<td><div style="background:#009fea; border-color:#009fea" _color="#009fea"></div></td>','<td><div style="background:#0067b8; border-color:#0067b8" _color="#0067b8"></div></td>','<td><div style="background:#00469e; border-color:#00469e" _color="#00469e"></div></td>','<td><div style="background:#1d1f88; border-color:#1d1f88" _color="#1d1f88"></div></td>','<td><div style="background:#5e1986; border-color:#5e1986" _color="#5e1986"></div></td>','<td><div style="background:#94077e; border-color:#94077e" _color="#94077e"></div></td>','<td><div style="background:#e40076; border-color:#e40076" _color="#e40076"></div></td>','<td><div style="background:#e6004b; border-color:#e6004b" _color="#e6004b"></div></td>','<td><div style="background:#959595; border-color:#959595" _color="#959595"></div></td>',"</tr>","<tr>",'<td><div style="background:#ec6941; border-color:#ec6941" _color="#ec6941"></div></td>','<td><div style="background:#f19048; border-color:#f19048" _color="#f19048"></div></td>','<td><div style="background:#f7b250; border-color:#f7b250" _color="#f7b250"></div></td>','<td><div style="background:#fff15b; border-color:#fff15b" _color="#fff15b"></div></td>','<td><div style="background:#b3d465; border-color:#b3d465" _color="#b3d465"></div></td>','<td><div style="background:#7ec269; border-color:#7ec269" _color="#7ec269"></div></td>','<td><div style="background:#31b06d; border-color:#31b06d" _color="#31b06d"></div></td>','<td><div style="background:#11b4ae; border-color:#11b4ae" _color="#11b4ae"></div></td>','<td><div style="background:#00b3ee; border-color:#00b3ee" _color="#00b3ee"></div></td>','<td><div style="background:#4489c9; border-color:#4489c9" _color="#4489c9"></div></td>','<td><div style="background:#556db4; border-color:#556db4" _color="#556db4"></div></td>','<td><div style="background:#5e529f; border-color:#5e529f" _color="#5e529f"></div></td>','<td><div style="background:#8957a0; border-color:#8957a0" _color="#8957a0"></div></td>','<td><div style="background:#ad5c9f; border-color:#ad5c9f" _color="#ad5c9f"></div></td>','<td><div style="background:#ea679f; border-color:#ea679f" _color="#ea679f"></div></td>','<td><div style="background:#eb6975; border-color:#eb6975" _color="#eb6975"></div></td>','<td><div style="background:#a0a0a0; border-color:#a0a0a0" _color="#a0a0a0"></div></td>',"</tr>","<tr>",'<td><div style="background:#f29b75; border-color:#f29b75" _color="#f29b75"></div></td>','<td><div style="background:#f5b180; border-color:#f5b180" _color="#f5b180"></div></td>','<td><div style="background:#f9cb8a; border-color:#f9cb8a" _color="#f9cb8a"></div></td>','<td><div style="background:#fff699; border-color:#fff699" _color="#fff699"></div></td>','<td><div style="background:#cbe198; border-color:#cbe198" _color="#cbe198"></div></td>','<td><div style="background:#acd598; border-color:#acd598" _color="#acd598"></div></td>','<td><div style="background:#88c998; border-color:#88c998" _color="#88c998"></div></td>','<td><div style="background:#85ccc8; border-color:#85ccc8" _color="#85ccc8"></div></td>','<td><div style="background:#7dcbf4; border-color:#7dcbf4" _color="#7dcbf4"></div></td>','<td><div style="background:#89abda; border-color:#89abda" _color="#89abda"></div></td>','<td><div style="background:#8d97ca; border-color:#8d97ca" _color="#8d97ca"></div></td>','<td><div style="background:#8e82bb; border-color:#8e82bb" _color="#8e82bb"></div></td>','<td><div style="background:#aa89bc; border-color:#aa89bc" _color="#aa89bc"></div></td>','<td><div style="background:#c490bd; border-color:#c490bd" _color="#c490bd"></div></td>','<td><div style="background:#f19ebf; border-color:#f19ebf" _color="#f19ebf"></div></td>','<td><div style="background:#f19c9c; border-color:#f19c9c" _color="#f19c9c"></div></td>','<td><div style="background:#c9c9c9; border-color:#c9c9c9" _color="#c9c9c9"></div></td>',"</tr>","</table>"].join(""),init:function(){var a=this;new FixToolbar({target:"div.tool-btm"});$(".skinsetting div:not(.custom)").click(function(){a.selectSkin($(this))});$("#custom-color").click(function(){a.initColorPicker()});$("#custom-pic").click(function(){a.initUpload()});$('input[name="preview"]').click(function(){var b=a.getSelected();window.open(BASE_PATH+"/settings/page/preview?type="+b.type+"&value="+encodeURIComponent(b.value))});$('input[name="save"]').click(function(){a.save("#theform")})},initColorPicker:function(){var a=this;if(this.colorPickerWin===null){this.colorPickerWin=Admin.window({id:"win-colorPicker",width:376,title:"\u81ea\u5b9a\u4e49\u767b\u9646\u80cc\u666f\u989c\u8272",formid:"colorform",body:a.colorPickerTpl,footer:'<input name="submit" type="submit" class="btn" value="\u786e\u5b9a"><input name="close" type="button" class="btn" value="\u53d6\u6d88" />',action:BASE_PATH+"/settings/page/save-color",draggable:true,init:function(){var c=this.find("form");c.submit(function(){return false});c.submit(function(){a.saveColor(c)});this.find('input[name="close"]').click(function(){a.colorPickerWin.close()});var d=this.find(".color_picker td");var b=this.find(".color_picker");d.bind("mousedown",function(){var f=b.find("div.selected");var e=f.attr("_color");f.parent().removeClass();f.removeClass().css({"border-color":e});$(this).find("div").addClass("selected").css({"border-color":"#ffffff"});$(this).find("div").parent().addClass("selected")});d.bind("mouseover",function(){$(this).find("div:not(.selected)").css({"border-color":"#ffffff"})}).bind("mouseout",function(){var e=$(this).find("div").attr("_color");$(this).find("div:not(.selected)").css({"border-color":e})})},onShow:function(){},onClose:function(){a.colorPickerWin.destroy();a.colorPickerWin=null}})}this.colorPickerWin.show()},saveColor:function(c){var b=this,a=this.getSelectedColor(c);if(!a){Message.show("\u8bf7\u5148\u9009\u62e9\u989c\u8272");return false}$.ajax({type:"POST",dataType:"json",url:c.attr("action"),data:{color:a},success:function(e){Message.show(e.message,5000,e.success);if(e.success&&e.data){if(b.colorPickerWin!==null){b.colorPickerWin.close()}if(e.data.color){var d=e.data.color;b.updateColorBox(d)}else{location.assign(location.href)}}},error:function(d){Message.show(Message.PROCESSING_ERROR);return false}})},updateColorBox:function(a){var b=$("#skin-color");if(b.size()<=0){location.assign(location.href)}b.find('input[name="value"]').val("CUSTOM:"+a);b.find("img").css({background:a});if($("#skin-color:hidden").size()){b.show()}this.selectSkin(b)},getSelectedColor:function(c){var b=c.find("td.selected");if(b.size()<=0){return null}var a=b.find("div").attr("_color");return a},initUpload:function(){var a=this;if(this.uploadWin===null){this.uploadWin=Admin.window({id:"login-uploadwin",width:550,title:"\u4e0a\u4f20\u767b\u9646\u56fe\u7247",formid:"login-uploadform",body:['<div class="realwin"><p class="gray">(\u8bf7\u70b9\u51fb\u201c\u6d4f\u89c8\u201d\uff0c\u5728\u60a8\u7535\u8111\u4e2d\u9009\u62e9\u60a8\u8981\u4e0a\u4f20\u7684\u7167\u7247\u3002)</p>','<div>\u9009\u62e9\u7167\u7247\uff1a<input id="imagefile" type="file" name="file" class="btn" size="40" />&nbsp;<input id="uploadfile" type="button" name="upload" class="btn" value="\u7acb\u5373\u4e0a\u4f20" /><input id="fileurl" type="hidden" name="fileurl" value="" /><input id="filetype" type="hidden" name="filetype" value="" /></div>','<p class="gray">\u652f\u6301jpg\u3001png\u3001gif\uff0c\u6587\u4ef6\u5927\u5c0f\u4e0d\u8d85\u8fc72M\u3002</p>','<div class="line-solid"></div>','<div id="preview-img" style="display:none;"><p>\u7f29\u7565\u56fe</p>','<div class="preview-box"><img id="login-img" src=""></div></div>',"</div>"].join(""),footer:'<input name="submit" type="submit" disabled="disabled" class="btn" value="\u786e\u5b9a"><input name="close" type="button" class="btn" value="\u53d6\u6d88" />',action:BASE_PATH+"/settings/page/save-image",draggable:true,init:function(){var b=this.find("form");b.submit(function(){return false});b.submit(function(){a.saveImage(b)});this.find('input[name="close"]').click(function(){a.uploadWin.close()});this.find('input[name="upload"]').bind("click",function(){a.uploadFile("#login-uploadform")});Frame.queryParent("#login-img").bind("load",function(){var c=this.width;if(c>450){$(this).css({width:"450px",height:"auto"})}var d=this.height;if(d>300){$(this).css({width:"auto",height:"300px"})}if(a.uploadWin!==null){a.uploadWin.center()}})},onShow:function(){},onClose:function(){a.uploadWin.destroy();a.uploadWin=null}})}this.uploadWin.show()},uploadFile:function(d){Frame.queryParent("#fileurl").val("");Frame.queryParent('input[name="submit"]').attr("disabled",true);var a=Frame.queryParent("#imagefile");var e=a.val();if(e.length<=0){Message.show("\u8bf7\u9009\u62e9\u60a8\u8981\u4e0a\u4f20\u7684\u56fe\u7247");return false}var c=e.lastIndexOf(".");var b=e.substring(c,e.length).toUpperCase();if(b.length>0&&b!=".PNG"&&b!=".GIF"&&b!=".JPG"&&b!=".JPEG"){Message.show("\u4ec5\u9650\u4e0a\u4f20jpg\u3001png\u3001gif\u683c\u5f0f\u7684\u56fe\u7247");Frame.queryParent("#preview-img").hide();a.val("");return false}this.upload(d)},upload:function(b){var a=this,b=$(b);Frame.getJQ().ajaxUpload({url:BASE_PATH+"/settings/page/upload",file:Frame.queryParent("#imagefile"),data:{},dataType:"text",success:function(c){var c=c.match(/\{[^\}]+\}\}/).toString();c=(new Function("return "+c+";"))();Message.show(c.message,5000,c.success);if(!c.success){Frame.queryParent("#imagefile").val("");Frame.queryParent("#fileurl").val("");Frame.queryParent("#filetype").val("");Frame.queryParent("#preview-img").hide();Frame.queryParent('input[name="submit"]').attr("disabled",true)}if(c.success&&c.data.fileurl){Frame.queryParent("#preview-img").show();Frame.queryParent("#login-img").attr("src",BASE_PATH+"/settings/page/file?hash="+c.data.fileurl);Frame.queryParent("#fileurl").val(c.data.fileurl);Frame.queryParent("#filetype").val(c.data.filetype);Frame.queryParent('input[name="submit"]').attr("disabled",false)}if(a.uploadWin!==null){a.uploadWin.center()}},error:function(c){Message.show(Message.PROCESSING_ERROR);Frame.queryParent("#imagefile").val("");Frame.queryParent("#fileurl").val("");Frame.queryParent("#filetype").val("");Frame.queryParent("#preview-img").hide();Frame.queryParent('input[name="submit"]').attr("disabled",true);return false}})},saveImage:function(d){var c=this,d=$(d),b=d.find('input[name="fileurl"]').val(),a=d.find('input[name="filetype"]').val();if(b.length<=0){Message.show("\u83b7\u53d6\u56fe\u7247\u8def\u5f84\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5");return false}$.ajax({type:"POST",dataType:"json",url:d.attr("action"),data:{fileurl:b,filetype:a},success:function(f){Message.show(f.message,5000,f.success);if(f.success&&f.data){if(c.uploadWin!==null){c.uploadWin.close()}if(f.data.fileurl){var e=f.data.fileurl;c.updatePicBox(e)}else{location.assign(location.href)}}},error:function(e){Message.show(Message.PROCESSING_ERROR);return false}})},updatePicBox:function(a){var b=$("#skin-pic");if(b.size()<=0){location.assign(location.href)}b.find('input[name="value"]').val("CUSTOM:"+a);b.find("img").attr("src",BASE_PATH+"/settings/page/file?hash="+a);if($("#skin-pic:hidden").size()){b.show()}this.selectSkin(b)},selectSkin:function(a){$(".skinsetting div").removeClass("skin_select");a.addClass("skin_select")},getSelected:function(){var c=$("#theform"),b=c.find(".skin_select");if(b.size()<=0){Message.show("\u8bf7\u9009\u62e9\u4f60\u8981\u9884\u89c8\u7684\u767b\u9646\u9875\u9762\u6a21\u677f");return false}var a=b.find('input[name="type"]').val(),d=b.find('input[name="value"]').val();return{type:a,value:d}},save:function(c){var c=$(c),b=c.find(".skin_select"),a=b.find('input[name="type"]').val(),d=b.find('input[name="value"]').val();if(b.size()<=0){Message.show("\u8bf7\u9009\u62e9\u767b\u9646\u9875\u9762\u6a21\u677f");return false}c.find("input, button").attr("disabled",true);$.ajax({type:"POST",dataType:"json",data:{type:a,value:d},url:c.attr("action"),success:function(e){Message.show(e.message,5000,e.success);c.find("input, button").attr("disabled",false)},error:function(e){Message.show(Message.PROCESSING_ERROR);c.find("input, button").attr("disabled",false);return false}})}};Settings.General={init:function(){$('input[name="save"]').click(function(){Settings.General.save("#theform")});new FixToolbar({target:"div.tool-btm"});if(UI.SingleSelect){var b=new UI.SingleSelect({select:"#timezone",id:"timezone-select",cls:"select",maxHeight:150,menuCls:"option"});b.appendTo($("#timezone").parent());var a=new UI.SingleSelect({select:"#dateformat",id:"dateformat-select",cls:"select",menuCls:"option"});a.appendTo($("#dateformat").parent())}},save:function(a){var a=$(a),b=a.serializeArray();a.find('input:not([name="status"]), button, select').attr("disabled",true);$.ajax({type:"POST",dataType:"json",data:b,url:a.attr("action"),success:function(c){Message.show(c.message,5000,c.success);a.find('input:not([name="status"]), button, select').attr("disabled",false)},error:function(c){Message.show(Message.PROCESSING_ERROR);a.find('input:not([name="status"]), button, select').attr("disabled",false);return false}})}};Settings.Theme={init:function(){$('input[name="save"]').click(function(){Settings.Theme.save("#theform")});$(".skinsetting div").click(function(){Settings.Theme.selectSkin($(this).find('input[name="skin"]').val())});new FixToolbar({target:"div.tool-btm"})},selectSkin:function(a){$(".skin_select").removeClass("skin_select");$("#skin-"+a).addClass("skin_select");$("#skin-"+a+' :radio[name="skin"]').attr("checked",true)},save:function(a){var a=$(a),b=a.serializeArray(),c=$(':radio[name="skin"]:checked').val();a.find("input, button").attr("disabled",true);$.ajax({type:"POST",dataType:"json",data:b,url:a.attr("action"),success:function(d){Message.show(d.message,5000,d.success);a.find("input, button").attr("disabled",false);history.go(1)},error:function(d){Message.show(Message.PROCESSING_ERROR);a.find("input, button").attr("disabled",false);return false}})}};
